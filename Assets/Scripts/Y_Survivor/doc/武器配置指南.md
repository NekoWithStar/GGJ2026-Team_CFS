# 武器配置指南

**版本**: v2.2 | **更新**: 2026-01-31

---

## 📋 配置流程

1. 创建 Weapon 数据（ScriptableObject）
2. 配置武器 Prefab
3. 关联数据与 Prefab
4. 测试验证

---

## 🔧 Weapon 数据配置

### 创建方式

右键菜单：`Create > Weapon > Weapon Data`

### 基础属性

| 字段 | 说明 | 示例值 |
|------|------|--------|
| **weaponName** | 武器名称 | "手枪" |
| **weaponIcon** | 武器图标 | Sprite 资源 |
| **description** | 武器描述 | "普通手枪" |
| **weaponType** | 武器类型 | Ranged（远程）或 Melee（近战）|

### 战斗属性

| 字段 | 说明 | 推荐值 |
|------|------|--------|
| **damage** | 基础伤害 | 远程: 10-30, 近战: 20-50 |
| **attackRate** | 攻击速率（次/秒）| 远程: 1-5, 近战: 0.5-2 |
| **cooldown** | 冷却时间（秒）| 0.2-2.0 |
| **fireRate** | 射速（发/秒）| 仅远程，1-10 |

### 暴击属性

| 字段 | 说明 | 推荐值 |
|------|------|--------|
| **critChanceBase** | 暴击率 | 0.05-0.3（5%-30%）|
| **critDamageBase** | 暴击倍率 | 1.5-3.0 |

### 类型专属配置

#### 远程武器

| 字段 | 说明 | 必填 |
|------|------|------|
| **projectilePrefab** | 子弹 Prefab | ✅ 是 |
| **firePattern** | 发射模式 | ✅ 是 |
| **bulletSpeed** | 子弹速度 | 5-20 |
| **maxDistance** | 最大射程 | 10-50 |
| **projectileCount** | 单次发射数量 | 1-10 |

**发射模式选项**：
- `Single`: 单发直射
- `Multi`: 多发散射（配合 projectileCount）
- `Spiral`: 螺旋散射
- `Circle`: 环形散射

#### 近战武器

| 字段 | 说明 | 必填 |
|------|------|------|
| **meleeRange** | 攻击范围 | ✅ 是（1-5）|

---

## 🎮 武器 Prefab 配置

### 必需组件

```
UniversalWeapon (Prefab)
├─ WeaponControl          ✅ 武器行为控制
├─ WeaponPropertyManager  ✅ 属性管理
├─ MuzzlePoint (Transform)✅ 远程武器发射点
└─ AudioSource            ⭐ 音效播放
```

### WeaponControl 设置

在 Inspector 中：
- **Weapon Data**: 留空（运行时设置）
- **MuzzlePoint**: 拖入子对象 Transform
- **Audio Source**: 拖入 AudioSource 组件

### WeaponPropertyManager 设置

无需配置，自动初始化。

---

## 📝 配置示例

### 示例：手枪

```
Weapon Data 配置：
━━━━━━━━━━━━━━━━━━
基础信息
  weaponName: "手枪"
  weaponType: Ranged
  weaponIcon: pistol_icon
  description: "基础远程武器"

战斗属性
  damage: 10
  attackRate: 2.0
  cooldown: 0.5
  fireRate: 2.0

暴击
  critChanceBase: 0.1 (10%)
  critDamageBase: 2.0

远程专属
  projectilePrefab: Bullet_Prefab
  firePattern: Single
  bulletSpeed: 15
  maxDistance: 30
  projectileCount: 1

关联
  weaponPrefab: UniversalWeapon
```

### 示例：霰弹枪

```
Weapon Data 配置：
━━━━━━━━━━━━━━━━━━
基础信息
  weaponName: "霰弹枪"
  weaponType: Ranged
  weaponIcon: shotgun_icon
  description: "一次发射多发子弹"

战斗属性
  damage: 8
  attackRate: 1.0
  cooldown: 1.0
  fireRate: 1.0

暴击
  critChanceBase: 0.15 (15%)
  critDamageBase: 1.8

远程专属
  projectilePrefab: Pellet_Prefab
  firePattern: Multi
  bulletSpeed: 12
  maxDistance: 15
  projectileCount: 5    ← 一次5发

关联
  weaponPrefab: UniversalWeapon
```

### 示例：近战剑

```
Weapon Data 配置：
━━━━━━━━━━━━━━━━━━
基础信息
  weaponName: "骑士剑"
  weaponType: Melee
  weaponIcon: sword_icon
  description: "基础近战武器"

战斗属性
  damage: 25
  attackRate: 1.5
  cooldown: 0.7

暴击
  critChanceBase: 0.2 (20%)
  critDamageBase: 2.5

近战专属
  meleeRange: 2.0

关联
  weaponPrefab: UniversalWeapon
```

---

## 🎯 特殊发射模式配置

### 自定义散射（Multi）

当使用 `Multi` 发射模式时，可配置散射角度：

**代码位置**: `MultiFirePattern.cs`

```csharp
// MultiFirePattern.cs (仅供参考，无需修改)
public class MultiFirePattern : FirePattern
{
    public float spreadAngle = 30f; // 散射角度（可在 Inspector 调整）
    
    // 示例：5发子弹，散射30度
    // 子弹分布：-15°, -7.5°, 0°, +7.5°, +15°
}
```

**调整方式**：
1. 选中武器 Prefab
2. 找到 `MultiFirePattern` 组件
3. 修改 `spreadAngle` 值（推荐 15-45）

### 螺旋发射（Spiral）

**代码位置**: `SpiralFirePattern.cs`

```csharp
// SpiralFirePattern.cs (仅供参考，无需修改)
public class SpiralFirePattern : FirePattern
{
    public float rotationSpeed = 90f; // 旋转速度（度/秒）
    
    // 每次发射时角度递增，形成螺旋效果
}
```

**调整方式**：
1. 选中武器 Prefab
2. 找到 `SpiralFirePattern` 组件
3. 修改 `rotationSpeed`（推荐 60-180）

### 环形发射（Circle）

**代码位置**: `CircleFirePattern.cs`

```csharp
// CircleFirePattern.cs (仅供参考，无需修改)
public class CircleFirePattern : FirePattern
{
    // projectileCount 决定子弹数量
    // 子弹均匀分布在360度圆周
    
    // 示例：8发子弹 → 每隔45度一发
}
```

**使用方式**：
- Weapon 数据中设置 `firePattern = Circle`
- 设置 `projectileCount`（推荐 6-12）

---

## ✅ 配置检查清单

### Weapon 数据检查

- [ ] weaponName 已填写
- [ ] weaponType 已选择（Melee/Ranged）
- [ ] damage > 0
- [ ] attackRate > 0
- [ ] 远程武器：projectilePrefab 已配置
- [ ] 远程武器：firePattern 已选择
- [ ] 近战武器：meleeRange > 0
- [ ] weaponPrefab 已关联

### Prefab 检查

- [ ] 包含 WeaponControl 组件
- [ ] 包含 WeaponPropertyManager 组件
- [ ] WeaponControl.MuzzlePoint 已设置（远程）
- [ ] 包含 AudioSource 组件

### 验证工具

使用 `WeaponSystemValidator` 自动检查：

1. 场景中添加空物体，命名 "WeaponValidator"
2. 添加组件：`WeaponSystemValidator`
3. 运行游戏，选中该对象
4. 按 `F1` 或右键菜单 → "Validate All Weapons"
5. 查看 Console 输出结果

---

## 🔧 常见问题

### 1. 远程武器不发射

**检查**：
- projectilePrefab 是否为空
- MuzzlePoint 是否设置
- bulletSpeed 是否 > 0

### 2. 近战武器无法攻击

**检查**：
- meleeRange 是否 > 0
- weaponType 是否为 Melee

### 3. 属性卡不生效

**检查**：
- Prefab 是否包含 WeaponPropertyManager
- 是否使用了正确的卡片选择方法（系统自动处理）

---

**文档维护**: GitHub Copilot  
**最后更新**: 2026-01-31
